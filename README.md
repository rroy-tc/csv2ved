CSV2VED
========

Getting Started
---------------

In addition to checking out this repository, to work on the platform core you
will also need:

- python >= 3.6
- pipenv >= 9.0.1
- gnupg >=2.2.4


GnuPG installation
------------------

GnuPG can be downloaded and installed using packages available at [https://gnupg.org/download/].
After installed you can verify the version by running

`gpg2 --version`

Please note on some OS the name of the installed binary might be gpg2

Generating encryption key
-------------------------

Production public keys are stored under csv2ved/gpg_keys directory and are imported into gpg keyring on the machine running the script.

If you need to generate your own keys (i.e. to test decryption of the encrypted file generated) you will need to overwrite one of these keys:

1. create your own public key in the default gpg home directory on your computer
    
    `gpg2 --full-generate-key`
    
    Follow the prompts, choose `RSA` type, `4096` bits key length, `ops@tucows.com` as email address
2. export the keys in ascii format
    `gpg2 --armor --export <key_id>`
3. update content of the file at `csv2ved/gpg_keys/augmented_service.asc` with your public key content       

Installation
------------

* Install pipenv (installs python 3 on your machine): `brew install pipenv` (in macOS)
* cd into this directory
* Create virtual environment: `pipenv --three`
* Install dependencies: `pipenv install --dev`
* Run the virtual environment: `pipenv shell`

Adding/removing packages
------------------------

* To add a package run `pipenv install <package_name>`
* To add a dev package run `pipenv install <package_name> --dev`
* To remove a package run  `pipenv uninstall <package_name>`
* To remove dev dependencies run `pipenv uninstall --dev`
* To uninstall app packages run `pipenv uninstall --all`

Please note, Pipfile and Pipfile.lock files are generated and should not be modified manually.

Run Tests
---------
* Run unit tests: `pytest tests` 

Run command line script
-----------------------

Installation

1. create python 3 virtual env in empty directory `pipenv --three`
2. activate `pipenv shell`
3. run `pip install csv2ved`

After installation `csv2ved` command line utility will be available in virtual environment.

run `csv2ved --help` for the list of available options


Generate Test File

Generate test file
------------------

The script `tests/utils/generate_csv_file.py` can be used to generate a .csv file with a defined number of lines. 
The supplied csv file should contain a header line and a sample data line (with an empty value for the member_id - the
member_id will be generated by the script. Sample input file `tests/utils/sample.csv`

* Generate test files:

    * General structure:
   
        `>> python ./tests/utils/generate_csv_file.py <csv_file> <num_copies> <output_filename>`
    
    * Example: Generates a csv file with a header line and 100000 lines
    
        `>> python ./tests/utils/generate_csv_file.py /abs/path/to/sample.csv 100000 test_100000.csv`
